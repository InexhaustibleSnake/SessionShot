// The project was made by Alexey Guchmazov Ilich (Inexhaustible Snake) for educational purposes

#include "Animations/Notify/SetInvulnerabilityNotify.h"
#include "AbilitySystemComponent.h"
#include "Characters/Components/Attributes/BaseAttributeSet.h"

void USetInvulnerabilityNotify::Notify(
    USkeletalMeshComponent* MeshComp, UAnimSequenceBase* Animation, const FAnimNotifyEventReference& EventReference)
{
    if (!MeshComp) return;

    auto MeshOwner = MeshComp->GetOwner();
    if (!MeshOwner) return;

    auto AbilityComponent = MeshOwner->FindComponentByClass<UAbilitySystemComponent>();
    if (!AbilityComponent) return;

    auto AttributeSet = AbilityComponent->GetAttributeSet(UAttributeSet::StaticClass());

    auto BaseAttributeSet = Cast<UBaseAttributeSet>(AttributeSet);
    if (!BaseAttributeSet) return;

    BaseAttributeSet->SetIsInvulnerable(Invulnerable);
}
